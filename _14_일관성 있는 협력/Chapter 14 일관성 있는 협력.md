# Chapter 14. 일관성 있는 협력

---

객체지향 설계의 목표는 적절한 책임을 수행하는 객체들의 협력을 기반으로 결합도가 낮고 재사용 가능한 코드 구조를 창조하는 것이다.

유사한 기능을 구현하기 위해 유사한 협력 패턴을 사용하라. 일관성 있는 유사한 패턴을 따라 협력한다면 시스템을 이해하고 확장하기 위해 요구되는 부담을 줄일 수 있다.

*  **이번 장에서는 계속 반복되는 예제이기 때문에 코드에 대한 부분은 스킵하고 핵심만 설명하도록 한다.**

## 01. 핸드폰 과금 시스템 변경하기

---

네가지 요금 정책이 추가되는 예제를 통해 설명하고자 하는 내용  

- 일관성 없는 코드가 가지는 문제점
- 코드 재사용을 위한 상속은 해롭다
    - 인스턴스 변수와, 메서드를 재사용하기 위해서 상속을 받은 경우, 강한 결합도가 생겨 설계 개선과 새로운 기능의 추가를 방해한다.
    - 상속을 위해 설계된 클래스가 아닌것을 억지로 비틀어 상속을 받으면 코드의 이해도가 떨어지고 코드 구현마저 부자연스러워진다.

## 02. 설계에 일관성 부여하기

---

설계 원칙 중 첫 번째는 애플리케이션에서 달라지는 부분을 찾아내고, 달라지지 않는 부분으로부터 분리시키는 것이다 → 변경되는 부분을 따로 뽑아서 캡슐화한다. 그렇게 하면 나중에 바뀌지 않는 부분에는 영향을 미치지 않은 채로 그 부분만 고치거나 확장할 수 있다.

- 일관성 있는 설계를 만드는 데 훌륭한 조언
    - 널리 알려진 디자인 패턴을 학습하고 변경이라는 문맥 안에서 디자인 패턴을 적용해 보라. 빠른 시간 안에 전문가의 경험을 흡수할 수 있다.
- 조건 로직과 객체 탐색
    - 두 개 이상의 조건 로직 (if 문)이 존재하는 경우에, 변경의 주기가 서로 다른 코드가 한 클래스 안에 뭉쳐 있기 때문에 기존 코드 내부를 수정할 일이 잦아 오류가 발생할 확률이 높아진다.
    - 객체지향에서는 조건 로직을 객체 사이의 이동으로 변경해 처리한다.
    - 조건 로직을 객체 사이의 이동으로 대체하기 위해서는 커다란 클래스는 더 작은 클래스들로 분리해야 한다 → 단일 책임 원칙을 적용해 클래스를 분리한다.
    - 유사한 행동을 수행하는 작은 클래스들은 자연스럽게 역할이라는 추상화로 묶이고 그 간의 협력 방식이 전체 설계의 일관성을 유지할 수 있게 해준다.
- 일관성 있는 협력을 위한 지침
    - 변하는 개념을 캡슐화하라.
    - 핵심은 훌륭한 추상화를 찾아 추상화에 의존하게 만드는 것. 추상화에 대한 의존은 결합도를 낮추고 대체 가능한 역할로 구성된 협력을 설계할 수 있게 해준다. → 추상화의 품질이 캡슐화의 품질이 된다.
- 캡슐화 (Encapsulation)란?
    - 데이터캡슐화 → 인스턴스 변수의 가시성을 제한하기 때문에 속성에 접근하려면 public 메서드를 이용하는 방법밖에 없다.
    - 메서드 캡슐화 → 외부에서 메서드에 직접 접근할 수 없고 내부와 서브클래스에서만 접근이 가능해 외부에 영향을 미치지 않고 메서드를 수정할 수 있다. 클래스의 내부 행동을 캡슐화한다고 한다.
    - 객체 캡슐화 → 가시성을 제한하기 때문에 객체간의 관계를 변경 하더라도 외부에는 영향을 미치지 않는다. (합성을 의미한다.)
    - 서브타입 캡슐화 → 다형성의 기반이 된다. 컴파일 시점에는 A 인터페이스와 관계를 맺고있어 B, C에 대해 정보를 알 수 없지만. 실행시점에는 실제로 B, C 와 협력할 수 있는 관계

    위 네가지는 캡슐화가 포함하는 객체지향의 핵심이다.

1. 구성 요소를 캡슐화하는 실행 지침은 객체지향의 핵심 덕목 중 하나이다. 시스템을 책임을 캡슐화한 섬들로 분리하고 그 섬들 간의 결합도를 제한하라 → 패턴의 공통적인 경향이기도 함.
2. 변경을 캡슐화 할 수 있는 다양한 방법이 존재하지만 협력을 일관성 있게 만들기 위해 가장 일반적으로 서브타입 캡슐화(상속)와 객체 캡슐화(합성)를 조합해 사용한다.

  ***  대표적인 방법일 뿐 정답은 아니니 자세한 내용은 디자인 패턴을 참고하자.**

## 03. 일관성 있는 기본 정책 구현하기

---

- 변경 분리하기
    - 변하지 않는 '규칙'으로부터 변하는 '적용조건'을 분리해야 한다.
    - 핵심은 훌륭한 추상화를 찾아 추상화에 의존하게 만드는 것. 추상화에 대한 의존은 결합도를 낮추고 대체 가능한 역할로 구성된 협력을 설계할 수 있게 해준다. → 추상화의 품질이 캡슐화의 품질이 된다.
- 변경 캡슐화하기
    - 변하지 않는 부분으로부터 변하는 부분을 분리하는 것 → 인터페이스를 통한 분리 등을 통해 추상화에 대한 의존성을 가지고 전체적 협력을 구현할 수 있음

개념적 무결성이 시스템 설계에서 가장 중요하다. 하나의 통합된 일련의 설계 아이디어를 반영하는 시스템이 좋다. 이러한 일관성, 통합된 설계 아이디어를 반영하기 위한 좋은 도구 중 하나는 '디자인패턴'이다.  - 저자

[https://www.notion.so/Chapter-14-e0088fbff3254a0d81556cf6a05e93a4](https://www.notion.so/Chapter-14-e0088fbff3254a0d81556cf6a05e93a4)